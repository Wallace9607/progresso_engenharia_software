<main id="progresso-content">

  <h1>ðŸ“ˆ Progresso do Curso</h1>

  <div class="progress-ring" id="ring-progresso">
    <div class="ring-fill" id="ring-text">0%</div>
  </div>

  <h2>Por Semestre</h2>
  <ul id="lista-semestres"></ul>

</main>

<style>
  #progresso-content { padding: 10px; }

  .progress-ring {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    margin: 20px auto;
    display: grid;
    place-items: center;
    font-weight: 700;
    background: conic-gradient(var(--accent) 0% 0%, rgba(255,255,255,0.05) 0% 100%);
  }

  .ring-fill {
    font-size: 22px;
    color: var(--text);
  }

  #lista-semestres li {
    padding: 6px 0;
    color: var(--muted);
  }
</style>

<script>
/* ============================================================
   INTEGRAÃ‡ÃƒO DIRETA COM painel_dev.html
   Usa o localStorage es_course_state_v1
   ============================================================ */

(function(){
  const STORAGE_KEY = "es_course_state_v1";

  const curriculum = [
    {title:'1Âº Semestre', count:8},
    {title:'2Âº Semestre', count:8},
    {title:'3Âº Semestre', count:8},
    {title:'4Âº Semestre', count:8},
    {title:'5Âº Semestre', count:8},
    {title:'6Âº Semestre', count:8},
    {title:'7Âº Semestre', count:8},
    {title:'8Âº Semestre', count:8},
  ];

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : null;
    }catch(e){
      return null;
    }
  }

  const state = loadState();
  if(!state){
    document.getElementById("progresso-content").innerHTML =
      "<p style='color:red'>Nenhum dado encontrado no painel_dev.html</p>";
    return;
  }

  /* --------------------------------------------------------
     PROGRESSO GERAL
  -------------------------------------------------------- */
  const flat = state.semesters.flat();
  const total = flat.length;
  const done = flat.filter(x => x.done).length;
  const pct = Math.round((done / total) * 100);

  const ring = document.getElementById("ring-progresso");
  const ringText = document.getElementById("ring-text");

  ring.style.background =
    `conic-gradient(var(--accent) 0% ${pct}%, rgba(255,255,255,0.05) ${pct}% 100%)`;

  ringText.textContent = pct + "%";

  /* --------------------------------------------------------
     PROGRESSO POR SEMESTRE
  -------------------------------------------------------- */
  const ul = document.getElementById("lista-semestres");
  ul.innerHTML = "";

  state.semesters.forEach((sem, index) => {
    const finished = sem.filter(c => c.done).length;
    const totalSem = curriculum[index].count;
    const pctSem = Math.round((finished / totalSem) * 100);

    const li = document.createElement("li");
    li.textContent = `${index+1}Âº Semestre â€“ ${pctSem}%`;
    ul.appendChild(li);
  });

})();
</script>
